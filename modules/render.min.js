!function(){d3.selection.prototype.theFuckTimeline=function(thefuck){var svg=this,AVAILABLE_SCALE=[1e4,5e3,2e3,1e3,500,200,100,50,20,10],min=9999,max=-9999;for(i in thefuck.lines)thefuck.lines[i].from<min&&(min=thefuck.lines[i].from),thefuck.lines[i].to>max&&(max=thefuck.lines[i].to);var i,mid=(max+min)/2,range=max-min,ratio=(svg.attr("width")-40)/range,scale=0;for(i in AVAILABLE_SCALE){var ac=parseInt(range/AVAILABLE_SCALE[i]);ac<5&&(scale=AVAILABLE_SCALE[i])}for(var axisPositions=[],minP=Math.ceil(min/scale),maxP=Math.floor(max/scale);minP<=maxP;)axisPositions.push(scale*minP),minP++;var posXFomula=function(d){return parseInt((d-min)*ratio+20)},posYFomula=function(d,i){return 45*i+40},barXFomula=function(d){return posXFomula(d.from)},barYFomula=function(d,i){return 45*i+40},barWFomula=function(d){return parseInt((d.to-d.from)*ratio)},axisXFormula=function(d){return parseInt((d-min)*ratio+20)},titleXFormula=function(d){var left=(d.from+d.to)/2<mid;return left?posXFomula(d.from)+10:posXFomula(d.to)-10},titleYFormula=function(d,i){return posYFomula(d,i)+15},titleAnchorFormula=function(d){var left=(d.from+d.to)/2<mid;return left?"begin":"end"},titleTextFomula=function(d){if("string"==typeof d.wiki&&""!==d.wiki)return"";var p1=d.from<0?"BC":"AD",p2=d.to<0?"BC":"AD",y1=Math.abs(d.from),y2=Math.abs(d.to);return d.title+" ("+p1+" "+y1+" ~ "+p2+" "+y2+")"},titleWikiFomula=function(d){if("string"!=typeof d.wiki||""===d.wiki)return"";var p1=d.from<0?"BC":"AD",p2=d.to<0?"BC":"AD",y1=Math.abs(d.from),y2=Math.abs(d.to);return d.title+" ("+p1+" "+y1+" ~ "+p2+" "+y2+")"};svg.classed("rtf-timeline",!0),svg.classed("rtf-theme-default",!0),svg.append("rect").classed("bg",!0).attr({x:0,y:0,width:"100%",height:"100%"}),svg.append("g").classed("bars-base",!0).selectAll("rect").data(thefuck.lines).enter().append("rect").attr({x:20,y:barYFomula,width:svg.attr("width")-40,height:30}),svg.append("g").classed("bars",!0).selectAll("rect").data(thefuck.lines).enter().append("rect").attr({x:barXFomula,y:barYFomula,width:barWFomula,height:30}),svg.append("g").classed("axes",!0).selectAll("line").data(axisPositions).enter().append("line").attr({x1:axisXFormula,y1:20,x2:axisXFormula,y2:svg.attr("height")-70}),svg.append("g").classed("axes-title",!0).selectAll("text").data(axisPositions).enter().append("text").attr({x:axisXFormula,y:svg.attr("height")-65}).text(function(d){return d}),svg.append("g").classed("bars-title",!0).selectAll("text").data(thefuck.lines).enter().append("text").attr({x:titleXFormula,y:titleYFormula,"text-anchor":titleAnchorFormula}).text(titleTextFomula),svg.select("g.bars-title").selectAll("a").data(thefuck.lines).enter().append("a").attr({"xlink:href":function(d){return"https://en.wikipedia.org/wiki/"+d.wiki},target:"_blank"}).append("text").attr({x:titleXFormula,y:titleYFormula,"text-anchor":titleAnchorFormula}).text(titleWikiFomula),svg.append("text").classed("title",!0).attr({x:svg.attr("width")/2,y:svg.attr("height")-20}).text(thefuck.settings.title);var ftid=svg.attr("id")+"-footer",style=THE_FUCK_STYLES.timeline,body=svg.html().replace("<defs></defs>",'<defs><style type="text/css">'+style+"</style></defs>"),blob=new Blob(['<?xml version="1.0"?>','<svg xmlns="http://www.w3.org/2000/svg">',body,"</svg>"],{type:"image/xml+svg"}),link=window.URL.createObjectURL(blob);d3.select("#"+ftid).append("a").attr({href:link,download:svg.attr("id")+".svg"}).text("Download")},d3.selection.prototype.theFuckError=function(thefuck){var svg=this;svg.attr("height",50),svg.select("defs").remove(),svg.classed("rtf-error",!0),svg.classed("rtf-theme-default",!0),svg.append("rect").classed("bg",!0).attr({x:0,y:0,width:"100%",height:"100%",fill:"#f07070"}),svg.append("text").attr({x:svg.attr("width")/2,y:svg.attr("height")/2,"text-anchor":"middle","font-size":"1.2em",fill:"#a00000"}).text(thefuck.settings.message)},d3.selectAll(".render-the-fuck").each(function(){var id=d3.select(this).attr("id"),thefuck=window.RENDER_THE_FUCK[id];switch(d3.select(this).attr("style","border: 1px solid #ddd; border-radius: 8px;"),thefuck.wtf){case"timeline":d3.select(this).theFuckTimeline(thefuck);break;case"error":d3.select(this).theFuckError(thefuck);break;default:d3.select(this).theFuckError({wtf:"error",settings:{message:"Unrecognize what the fuck."}})}})}();